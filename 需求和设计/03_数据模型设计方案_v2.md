# æ•°æ®æ¨¡å‹è®¾è®¡æ–¹æ¡ˆ v2.2

> **ç‰ˆæœ¬ï¼š** v2.2  
> **æ›´æ–°æ—¥æœŸï¼š** 2025-10-15  
> **æ–‡æ¡£çŠ¶æ€ï¼š** æ–°å¢å¤šæ—¶é—´ç»´åº¦ç»Ÿè®¡æ”¯æŒï¼Œæ”¯æŒæ—¥/å‘¨/æœˆ/å¹´/è‡ªå®šä¹‰ç»´åº¦æŸ¥è¯¢  
> **æƒå¨æ¥æºï¼š** ä¸ã€Šæœ¯è¯­ç»Ÿä¸€è¡¨ v2.3ã€‹å®Œå…¨åŒæ­¥

---

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€æœ¯è¯­**ï¼šæ‰€æœ‰è¡¨åã€å­—æ®µåä¸¥æ ¼éµå¾ªã€Šæœ¯è¯­ç»Ÿä¸€è¡¨ v2.1ã€‹
2. **å•æ•°è¡¨å**ï¼šæ‰€æœ‰è¡¨åä½¿ç”¨å•æ•°å½¢å¼ï¼ˆå¦‚ `app_session` è€Œé `app_sessions`ï¼‰
3. **è¡Œä¸ºè®°å½•**ï¼šæ— è®ºä½¿ç”¨æ—¶é•¿å¤šçŸ­ï¼Œè¡Œä¸ºå¿…é¡»è®°å½•ï¼ˆä¿è¯ç»Ÿè®¡å‡†ç¡®ï¼‰
4. **æ—¶é•¿è¿‡æ»¤**ï¼šçŸ­æ—¶ä¼šè¯durationè®¾ä¸º0ï¼Œä½†è®°å½•ä¿ç•™ï¼ˆç”¨äºå‡†ç¡®è®¡æ•°ï¼‰
5. **ç‰ˆæœ¬åŒæ­¥**ï¼šä¸æœ¯è¯­è¡¨ã€æŠ€æœ¯æ¶æ„æ–‡æ¡£ä¿æŒå®Œå…¨ä¸€è‡´

---

## ğŸ—ï¸ æ•°æ®åº“æ¶æ„

### ERå›¾ï¼ˆå®ä½“å…³ç³»å›¾ï¼‰

```mermaid
erDiagram
    app_session ||--o{ app_usage_detail : contains
    app_session ||--o{ daily_summary : contributes_to
    app_session ||--o{ daily_app_summary : contributes_to
    screen_event ||--o{ daily_summary : contributes_to
    daily_summary ||--o{ weekly_summary : aggregates_to
    daily_summary ||--o{ monthly_summary : aggregates_to
    daily_summary ||--o{ yearly_summary : aggregates_to
    user_goal ||--o{ daily_summary : tracks_progress
    app_metadata ||--o{ app_session : references
    app_metadata ||--o{ daily_app_summary : references
    notification_event ||--o{ app_session : may_trigger
    
    app_session {
        string session_id PK "ä¼šè¯å”¯ä¸€ID"
        string package_name FK "åº”ç”¨åŒ…å"
        long start_time "å¼€å§‹æ—¶é—´"
        long end_time "ç»“æŸæ—¶é—´"
        long duration "ä½¿ç”¨æ—¶é•¿"
        int switch_count "åˆ‡æ¢æ¬¡æ•°"
        string category "åº”ç”¨åˆ†ç±»"
        string trigger_type "è§¦å‘æ–¹å¼"
        string exit_type "é€€å‡ºæ–¹å¼"
        string collection_mode "æ”¶é›†æ¨¡å¼"
        string device_state "è®¾å¤‡çŠ¶æ€"
    }
    
    app_usage_detail {
        string detail_id PK "æ˜ç»†ID"
        string session_id FK "ä¼šè¯ID"
        long timestamp "æ—¶é—´æˆ³"
        string state_type "çŠ¶æ€ç±»å‹"
    }
    
    screen_event {
        string event_id PK "äº‹ä»¶ID"
        string event_type "äº‹ä»¶ç±»å‹"
        long timestamp "æ—¶é—´æˆ³"
        long duration "äº‹ä»¶æŒç»­æ—¶é—´"
    }
    
    notification_event {
        string notification_id PK "é€šçŸ¥ID"
        string package_name "åº”ç”¨åŒ…å"
        string action "ç”¨æˆ·æ“ä½œ"
        long timestamp "æ—¶é—´æˆ³"
        boolean is_interactive "æ˜¯å¦äº¤äº’"
    }
    
    daily_summary {
        string summary_id PK "æ±‡æ€»ID"
        string date "æ—¥æœŸ"
        long total_screen_time "ä»Šæ—¥å±å¹•æ—¶é•¿"
        int phone_unlock_count "æ‰‹æœºè§£é”æ¬¡æ•°"
        int app_open_count "APPæ‰“å¼€æ¬¡æ•°"
        long app_usage_duration "APPä½¿ç”¨æ—¶é•¿"
        int goal_progress "ç›®æ ‡è¿›åº¦"
    }
    
    daily_app_summary {
        string summary_id PK "æ±‡æ€»ID"
        string date "æ—¥æœŸ"
        string package_name "åº”ç”¨åŒ…å"
        string app_name "åº”ç”¨åç§°"
        string category "åº”ç”¨åˆ†ç±»"
        int app_open_count "APPæ‰“å¼€æ¬¡æ•°"
        long app_usage_duration "APPä½¿ç”¨æ—¶é•¿"
    }
    
    weekly_summary {
        string summary_id PK "æ±‡æ€»ID"
        string week_key "å‘¨æ ‡è¯†"
        int year "å¹´ä»½"
        int week_number "å‘¨æ•°"
        string start_date "èµ·å§‹æ—¥æœŸ"
        string end_date "ç»“æŸæ—¥æœŸ"
        long total_screen_time "å‘¨å±å¹•æ—¶é•¿"
        int phone_unlock_count "å‘¨è§£é”æ¬¡æ•°"
        int app_open_count "å‘¨APPæ‰“å¼€æ¬¡æ•°"
        long app_usage_duration "å‘¨APPä½¿ç”¨æ—¶é•¿"
    }
    
    monthly_summary {
        string summary_id PK "æ±‡æ€»ID"
        string month_key "æœˆæ ‡è¯†"
        int year "å¹´ä»½"
        int month "æœˆä»½"
        long total_screen_time "æœˆå±å¹•æ—¶é•¿"
        int phone_unlock_count "æœˆè§£é”æ¬¡æ•°"
        int app_open_count "æœˆAPPæ‰“å¼€æ¬¡æ•°"
        long app_usage_duration "æœˆAPPä½¿ç”¨æ—¶é•¿"
    }
    
    yearly_summary {
        string summary_id PK "æ±‡æ€»ID"
        int year "å¹´ä»½"
        long total_screen_time "å¹´å±å¹•æ—¶é•¿"
        int phone_unlock_count "å¹´è§£é”æ¬¡æ•°"
        int app_open_count "å¹´APPæ‰“å¼€æ¬¡æ•°"
        long app_usage_duration "å¹´APPä½¿ç”¨æ—¶é•¿"
    }
    
    user_goal {
        string goal_id PK "ç›®æ ‡ID"
        string goal_type "ç›®æ ‡ç±»å‹"
        long target_value "ç›®æ ‡å€¼"
        long current_value "å½“å‰å€¼"
        string period "å‘¨æœŸ"
        boolean is_active "æ˜¯å¦æ¿€æ´»"
    }
    
    app_metadata {
        string package_name PK "åº”ç”¨åŒ…å"
        string app_name "åº”ç”¨åç§°"
        string category "åº”ç”¨åˆ†ç±»"
        string icon_url "å›¾æ ‡URL"
        long install_time "å®‰è£…æ—¶é—´"
        boolean is_system "æ˜¯å¦ç³»ç»Ÿåº”ç”¨"
    }
```

---

## ğŸ“Š è¯¦ç»†è¡¨ç»“æ„

### 1. åº”ç”¨ä¼šè¯è¡¨ï¼ˆapp_sessionï¼‰

**æ ¸å¿ƒè¡¨ï¼Œè®°å½•æ¯æ¬¡APPä½¿ç”¨ä¼šè¯**

```sql
CREATE TABLE app_session (
    session_id TEXT PRIMARY KEY,
    package_name TEXT NOT NULL,
    app_name TEXT NOT NULL,
    category TEXT NOT NULL,
    start_time INTEGER NOT NULL,
    end_time INTEGER NOT NULL,
    duration INTEGER NOT NULL DEFAULT 0,
    switch_count INTEGER NOT NULL DEFAULT 1,
    trigger_type TEXT NOT NULL DEFAULT 'UNKNOWN',
    exit_type TEXT NOT NULL DEFAULT 'UNKNOWN',
    collection_mode TEXT NOT NULL DEFAULT 'STANDARD',
    device_state TEXT NOT NULL DEFAULT 'UNKNOWN',
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

-- ç´¢å¼•
CREATE INDEX idx_app_session_package_name ON app_session(package_name);
CREATE INDEX idx_app_session_start_time ON app_session(start_time);
CREATE INDEX idx_app_session_date ON app_session(date(start_time/1000, 'unixepoch'));
CREATE INDEX idx_app_session_category ON app_session(category);
```

**é‡è¦ä¿®æ­£è¯´æ˜ï¼š**
- âœ… **è¡¨å**ï¼šä½¿ç”¨å•æ•° `app_session`ï¼ˆä¸æ˜¯ `app_sessions`ï¼‰
- âœ… **å­—æ®µ**ï¼šåˆ é™¤äº† `openCount` å­—æ®µï¼ˆé¿å…ä¸å…¨å±€ç»Ÿè®¡æ··æ·†ï¼‰
- âœ… **æ–°å¢**ï¼š`switch_count` å­—æ®µè¡¨ç¤ºæœ¬ä¼šè¯å†…çš„åˆ‡æ¢æ¬¡æ•°
- âœ… **ç»Ÿè®¡**ï¼šå…¨å±€"APPæ‰“å¼€æ¬¡æ•°"é€šè¿‡ `COUNT(*)` ç»Ÿè®¡è®°å½•æ•°
- âœ… **é˜ˆå€¼**ï¼šduration=0çš„è®°å½•ä¹Ÿå‚ä¸è®¡æ•°ï¼ˆä¿è¯ç»Ÿè®¡å‡†ç¡®ï¼‰

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | Kotlinç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|-----------|------|------|
| session_id | TEXT | String (UUID) | PRIMARY KEY | ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼Œè‡ªåŠ¨ç”Ÿæˆ |
| package_name | TEXT | String | NOT NULL | åº”ç”¨åŒ…åï¼Œå¦‚ com.tencent.mm |
| app_name | TEXT | String | NOT NULL | åº”ç”¨æ˜¾ç¤ºåç§°ï¼Œå¦‚"å¾®ä¿¡" |
| category | TEXT | AppCategory(Enum) | NOT NULL | åº”ç”¨åˆ†ç±»æšä¸¾å€¼ |
| start_time | INTEGER | Long | NOT NULL | ä¼šè¯å¼€å§‹æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| end_time | INTEGER | Long | NOT NULL | ä¼šè¯ç»“æŸæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| duration | INTEGER | Long | DEFAULT 0 | ä½¿ç”¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œ<1ç§’è®¾ä¸º0 |
| switch_count | INTEGER | Int | DEFAULT 1 | æœ¬ä¼šè¯å†…åˆ‡æ¢æ¬¡æ•° |
| trigger_type | TEXT | TriggerType(Enum) | DEFAULT 'UNKNOWN' | è§¦å‘æ–¹å¼æšä¸¾å€¼ |
| exit_type | TEXT | ExitType(Enum) | DEFAULT 'UNKNOWN' | é€€å‡ºæ–¹å¼æšä¸¾å€¼ |
| collection_mode | TEXT | PerformanceMode(Enum) | DEFAULT 'STANDARD' | æ•°æ®æ”¶é›†æ¨¡å¼ |
| device_state | TEXT | DeviceState(Enum) | DEFAULT 'UNKNOWN' | è®¾å¤‡çŠ¶æ€æšä¸¾å€¼ |
| created_at | INTEGER | Long | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | Long | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |


**ä¸šåŠ¡è§„åˆ™æ–¹æ³•ï¼š**
- `isValidSession()`: åˆ¤æ–­æ˜¯å¦æœ‰æ•ˆä¼šè¯ï¼ˆduration >= 1000msï¼‰
- `getSessionDate()`: è·å–ä¼šè¯æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰

### 2. åº”ç”¨ä½¿ç”¨æ˜ç»†è¡¨ï¼ˆapp_usage_detailï¼‰

**è®°å½•ä¼šè¯å†…çš„çŠ¶æ€å˜åŒ–**

```sql
CREATE TABLE app_usage_detail (
    detail_id TEXT PRIMARY KEY,
    session_id TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    state_type TEXT NOT NULL,
    FOREIGN KEY (session_id) REFERENCES app_session(session_id) ON DELETE CASCADE
);

CREATE INDEX idx_detail_session_id ON app_usage_detail(session_id);
CREATE INDEX idx_detail_timestamp ON app_usage_detail(timestamp);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| detail_id | TEXT | PRIMARY KEY | æ˜ç»†è®°å½•å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| session_id | TEXT | FOREIGN KEY | å…³è”app_sessionè¡¨ |
| timestamp | INTEGER | NOT NULL | çŠ¶æ€å˜åŒ–æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| state_type | TEXT | NOT NULL | çŠ¶æ€ç±»å‹æšä¸¾å€¼ |

**å¤–é”®å…³ç³»ï¼š**
- å¼•ç”¨è¡¨: app_session(session_id)
- åˆ é™¤ç­–ç•¥: CASCADEï¼ˆåˆ é™¤ä¼šè¯æ—¶åŒæ­¥åˆ é™¤æ˜ç»†ï¼‰

### 3. å±å¹•äº‹ä»¶è¡¨ï¼ˆscreen_eventï¼‰

**è®°å½•å±å¹•å¼€å…³å’Œè§£é”äº‹ä»¶**

```sql
CREATE TABLE screen_event (
    event_id TEXT PRIMARY KEY,
    event_type TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    duration INTEGER DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_screen_event_type ON screen_event(event_type);
CREATE INDEX idx_screen_event_timestamp ON screen_event(timestamp);
CREATE INDEX idx_screen_event_date ON screen_event(date(timestamp/1000, 'unixepoch'));
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| event_id | TEXT | PRIMARY KEY | äº‹ä»¶å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| event_type | TEXT | NOT NULL | äº‹ä»¶ç±»å‹: SCREEN_ON/SCREEN_OFF/USER_PRESENT |
| timestamp | INTEGER | NOT NULL | äº‹ä»¶å‘ç”Ÿæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| duration | INTEGER | DEFAULT 0 | äº‹ä»¶æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_screen_event_type: äº‹ä»¶ç±»å‹ç´¢å¼•
- idx_screen_event_timestamp: æ—¶é—´æˆ³ç´¢å¼•
- idx_screen_event_date: æ—¥æœŸç´¢å¼•ï¼ˆç”¨äºæŒ‰æ—¥æŸ¥è¯¢ï¼‰

### 4. é€šçŸ¥äº‹ä»¶è¡¨ï¼ˆnotification_eventï¼‰

**è®°å½•é€šçŸ¥å’Œç”¨æˆ·å“åº”**

```sql
CREATE TABLE notification_event (
    notification_id TEXT PRIMARY KEY,
    package_name TEXT NOT NULL,
    action TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    is_interactive BOOLEAN DEFAULT FALSE,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_notification_package ON notification_event(package_name);
CREATE INDEX idx_notification_timestamp ON notification_event(timestamp);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| notification_id | TEXT | PRIMARY KEY | é€šçŸ¥å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| package_name | TEXT | NOT NULL | åº”ç”¨åŒ…å |
| action | TEXT | NOT NULL | ç”¨æˆ·æ“ä½œ: POSTED/CLICKED/DISMISSED |
| timestamp | INTEGER | NOT NULL | æ“ä½œæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |
| is_interactive | BOOLEAN | DEFAULT FALSE | æ˜¯å¦ä¸ºäº¤äº’å¼é€šçŸ¥ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_notification_package: åŒ…åç´¢å¼•
- idx_notification_timestamp: æ—¶é—´æˆ³ç´¢å¼•

### 5. æ¯æ—¥æ±‡æ€»è¡¨ï¼ˆdaily_summaryï¼‰

**é¢„è®¡ç®—çš„æ¯æ—¥ç»Ÿè®¡æ•°æ®**

```sql
CREATE TABLE daily_summary (
    summary_id TEXT PRIMARY KEY,
    date TEXT UNIQUE NOT NULL,
    total_screen_time INTEGER NOT NULL DEFAULT 0,
    phone_unlock_count INTEGER NOT NULL DEFAULT 0,
    app_open_count INTEGER NOT NULL DEFAULT 0,
    app_usage_duration INTEGER NOT NULL DEFAULT 0,
    goal_progress INTEGER DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_daily_summary_date ON daily_summary(date);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼ˆå››å¤§æ ¸å¿ƒæŒ‡æ ‡ï¼‰ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| summary_id | TEXT | PRIMARY KEY | æ±‡æ€»è®°å½•å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| date | TEXT | UNIQUE NOT NULL | æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰ |
| **total_screen_time** | INTEGER | DEFAULT 0 | ğŸ“± ä»Šæ—¥å±å¹•æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| **phone_unlock_count** | INTEGER | DEFAULT 0 | ğŸ”“ æ‰‹æœºè§£é”æ¬¡æ•° |
| **app_open_count** | INTEGER | DEFAULT 0 | ğŸ“² APPæ‰“å¼€æ¬¡æ•° |
| **app_usage_duration** | INTEGER | DEFAULT 0 | ğŸ”† APPä½¿ç”¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| goal_progress | INTEGER | DEFAULT 0 | ç›®æ ‡å®Œæˆåº¦ï¼ˆç™¾åˆ†æ¯”ï¼‰ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_daily_summary_date: æ—¥æœŸå”¯ä¸€ç´¢å¼•

**ç”¨é€”è¯´æ˜ï¼š**
- é¢„è®¡ç®—çš„æ¯æ—¥ç»Ÿè®¡æ•°æ®ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- é¿å…æ¯æ¬¡æŸ¥è¯¢éƒ½è¿›è¡Œèšåˆè®¡ç®—
- æ”¯æŒå†å²æ•°æ®å¿«é€Ÿæ£€ç´¢

### 6. ç”¨æˆ·ç›®æ ‡è¡¨ï¼ˆuser_goalï¼‰

**ç”¨æˆ·è®¾å®šçš„ä½¿ç”¨ç›®æ ‡**

```sql
CREATE TABLE user_goal (
    goal_id TEXT PRIMARY KEY,
    goal_type TEXT NOT NULL,
    target_value INTEGER NOT NULL,
    current_value INTEGER DEFAULT 0,
    period TEXT NOT NULL DEFAULT 'DAILY',
    is_active BOOLEAN DEFAULT TRUE,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_user_goal_type ON user_goal(goal_type);
CREATE INDEX idx_user_goal_active ON user_goal(is_active);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| goal_id | TEXT | PRIMARY KEY | ç›®æ ‡å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| goal_type | TEXT | NOT NULL | ç›®æ ‡ç±»å‹æšä¸¾å€¼ |
| target_value | INTEGER | NOT NULL | ç›®æ ‡å€¼ï¼ˆæ¯«ç§’æˆ–æ¬¡æ•°ï¼‰ |
| current_value | INTEGER | DEFAULT 0 | å½“å‰å€¼ï¼ˆå®æ—¶æ›´æ–°ï¼‰ |
| period | TEXT | DEFAULT 'DAILY' | ç»Ÿè®¡å‘¨æœŸ: DAILY/WEEKLY/MONTHLY |
| is_active | BOOLEAN | DEFAULT TRUE | æ˜¯å¦æ¿€æ´» |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_user_goal_type: ç›®æ ‡ç±»å‹ç´¢å¼•
- idx_user_goal_active: æ¿€æ´»çŠ¶æ€ç´¢å¼•

**ä¸šåŠ¡è§„åˆ™ï¼š**
- `getProgressPercentage()`: è®¡ç®—å®Œæˆåº¦ç™¾åˆ†æ¯” = (current_value * 100) / target_value

### 7. æ¯æ—¥åº”ç”¨æ±‡æ€»è¡¨ï¼ˆdaily_app_summaryï¼‰

**æ¯æ—¥å•åº”ç”¨ç»Ÿè®¡æ•°æ®**

```sql
CREATE TABLE daily_app_summary (
    summary_id TEXT PRIMARY KEY,
    date TEXT NOT NULL,
    package_name TEXT NOT NULL,
    app_name TEXT NOT NULL,
    category TEXT NOT NULL,
    app_open_count INTEGER NOT NULL DEFAULT 0,
    app_usage_duration INTEGER NOT NULL DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    UNIQUE(date, package_name)
);

CREATE INDEX idx_daily_app_date ON daily_app_summary(date);
CREATE INDEX idx_daily_app_package ON daily_app_summary(package_name);
CREATE INDEX idx_daily_app_category ON daily_app_summary(category);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| summary_id | TEXT | PRIMARY KEY | æ±‡æ€»è®°å½•å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| date | TEXT | NOT NULL | æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰ |
| package_name | TEXT | NOT NULL | åº”ç”¨åŒ…å |
| app_name | TEXT | NOT NULL | åº”ç”¨åç§° |
| category | TEXT | NOT NULL | åº”ç”¨åˆ†ç±» |
| app_open_count | INTEGER | DEFAULT 0 | è¯¥åº”ç”¨å½“æ—¥æ‰“å¼€æ¬¡æ•° |
| app_usage_duration | INTEGER | DEFAULT 0 | è¯¥åº”ç”¨å½“æ—¥ä½¿ç”¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_daily_app_date: æ—¥æœŸç´¢å¼•
- idx_daily_app_package: åŒ…åç´¢å¼•
- idx_daily_app_category: åˆ†ç±»ç´¢å¼•
- UNIQUEçº¦æŸ: (date, package_name) ä¿è¯æ¯æ—¥æ¯åº”ç”¨å”¯ä¸€

**ç”¨é€”è¯´æ˜ï¼š**
- æ”¯æŒå•åº”ç”¨è¯¦ç»†ç»Ÿè®¡æŸ¥è¯¢
- æå‡å•åº”ç”¨å†å²æ•°æ®æŸ¥è¯¢æ€§èƒ½
- æ”¯æŒåº”ç”¨æ’è¡Œæ¦œåŠŸèƒ½

### 8. æ¯å‘¨æ±‡æ€»è¡¨ï¼ˆweekly_summaryï¼‰

**æ¯å‘¨å…¨å±€ç»Ÿè®¡æ•°æ®**

```sql
CREATE TABLE weekly_summary (
    summary_id TEXT PRIMARY KEY,
    week_key TEXT UNIQUE NOT NULL,
    year INTEGER NOT NULL,
    week_of_year INTEGER NOT NULL,
    start_date TEXT NOT NULL,
    end_date TEXT NOT NULL,
    total_screen_time INTEGER NOT NULL DEFAULT 0,
    phone_unlock_count INTEGER NOT NULL DEFAULT 0,
    app_open_count INTEGER NOT NULL DEFAULT 0,
    app_usage_duration INTEGER NOT NULL DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_weekly_year ON weekly_summary(year);
CREATE INDEX idx_weekly_key ON weekly_summary(week_key);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| summary_id | TEXT | PRIMARY KEY | æ±‡æ€»è®°å½•å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| week_key | TEXT | UNIQUE NOT NULL | å‘¨æ ‡è¯†ï¼ˆæ ¼å¼ï¼šYYYY-Wwwï¼Œå¦‚2024-W42ï¼‰ |
| year | INTEGER | NOT NULL | å¹´ä»½ï¼ˆå¦‚2024ï¼‰ |
| week_of_year | INTEGER | NOT NULL | å¹´å†…ç¬¬å‡ å‘¨ï¼ˆ1-53ï¼‰ |
| start_date | TEXT | NOT NULL | å‘¨å¼€å§‹æ—¥æœŸï¼ˆå‘¨ä¸€ï¼ŒYYYY-MM-DDï¼‰ |
| end_date | TEXT | NOT NULL | å‘¨ç»“æŸæ—¥æœŸï¼ˆå‘¨æ—¥ï¼ŒYYYY-MM-DDï¼‰ |
| total_screen_time | INTEGER | DEFAULT 0 | æœ¬å‘¨å±å¹•æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| phone_unlock_count | INTEGER | DEFAULT 0 | æœ¬å‘¨è§£é”æ¬¡æ•° |
| app_open_count | INTEGER | DEFAULT 0 | æœ¬å‘¨APPæ‰“å¼€æ¬¡æ•° |
| app_usage_duration | INTEGER | DEFAULT 0 | æœ¬å‘¨APPä½¿ç”¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_weekly_year: å¹´ä»½ç´¢å¼•
- idx_weekly_key: å‘¨æ ‡è¯†å”¯ä¸€ç´¢å¼•

**æ•°æ®æ¥æºï¼š**
- åŸºäº `daily_summary` è¡¨èšåˆè®¡ç®—
- æ¯å‘¨ä¸€å‡Œæ™¨è‡ªåŠ¨æ±‡æ€»ä¸Šå‘¨æ•°æ®

### 9. æ¯æœˆæ±‡æ€»è¡¨ï¼ˆmonthly_summaryï¼‰

**æ¯æœˆå…¨å±€ç»Ÿè®¡æ•°æ®**

```sql
CREATE TABLE monthly_summary (
    summary_id TEXT PRIMARY KEY,
    month_key TEXT UNIQUE NOT NULL,
    year INTEGER NOT NULL,
    month INTEGER NOT NULL,
    total_screen_time INTEGER NOT NULL DEFAULT 0,
    phone_unlock_count INTEGER NOT NULL DEFAULT 0,
    app_open_count INTEGER NOT NULL DEFAULT 0,
    app_usage_duration INTEGER NOT NULL DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_monthly_year ON monthly_summary(year);
CREATE INDEX idx_monthly_key ON monthly_summary(month_key);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| summary_id | TEXT | PRIMARY KEY | æ±‡æ€»è®°å½•å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| month_key | TEXT | UNIQUE NOT NULL | æœˆæ ‡è¯†ï¼ˆæ ¼å¼ï¼šYYYY-MMï¼Œå¦‚2024-10ï¼‰ |
| year | INTEGER | NOT NULL | å¹´ä»½ï¼ˆå¦‚2024ï¼‰ |
| month | INTEGER | NOT NULL | æœˆä»½ï¼ˆ1-12ï¼‰ |
| total_screen_time | INTEGER | DEFAULT 0 | æœ¬æœˆå±å¹•æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| phone_unlock_count | INTEGER | DEFAULT 0 | æœ¬æœˆè§£é”æ¬¡æ•° |
| app_open_count | INTEGER | DEFAULT 0 | æœ¬æœˆAPPæ‰“å¼€æ¬¡æ•° |
| app_usage_duration | INTEGER | DEFAULT 0 | æœ¬æœˆAPPä½¿ç”¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_monthly_year: å¹´ä»½ç´¢å¼•
- idx_monthly_key: æœˆæ ‡è¯†å”¯ä¸€ç´¢å¼•

**æ•°æ®æ¥æºï¼š**
- åŸºäº `daily_summary` è¡¨èšåˆè®¡ç®—
- æ¯æœˆ1æ—¥å‡Œæ™¨è‡ªåŠ¨æ±‡æ€»ä¸Šæœˆæ•°æ®

### 10. æ¯å¹´æ±‡æ€»è¡¨ï¼ˆyearly_summaryï¼‰

**æ¯å¹´å…¨å±€ç»Ÿè®¡æ•°æ®**

```sql
CREATE TABLE yearly_summary (
    summary_id TEXT PRIMARY KEY,
    year INTEGER UNIQUE NOT NULL,
    total_screen_time INTEGER NOT NULL DEFAULT 0,
    phone_unlock_count INTEGER NOT NULL DEFAULT 0,
    app_open_count INTEGER NOT NULL DEFAULT 0,
    app_usage_duration INTEGER NOT NULL DEFAULT 0,
    created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000),
    updated_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_yearly_year ON yearly_summary(year);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| summary_id | TEXT | PRIMARY KEY | æ±‡æ€»è®°å½•å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| year | INTEGER | UNIQUE NOT NULL | å¹´ä»½ï¼ˆå¦‚2024ï¼‰ |
| total_screen_time | INTEGER | DEFAULT 0 | æœ¬å¹´å±å¹•æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| phone_unlock_count | INTEGER | DEFAULT 0 | æœ¬å¹´è§£é”æ¬¡æ•° |
| app_open_count | INTEGER | DEFAULT 0 | æœ¬å¹´APPæ‰“å¼€æ¬¡æ•° |
| app_usage_duration | INTEGER | DEFAULT 0 | æœ¬å¹´APPä½¿ç”¨æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ |
| created_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•åˆ›å»ºæ—¶é—´æˆ³ |
| updated_at | INTEGER | è‡ªåŠ¨è®¾ç½® | è®°å½•æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_yearly_year: å¹´ä»½å”¯ä¸€ç´¢å¼•

**æ•°æ®æ¥æºï¼š**
- åŸºäº `daily_summary` è¡¨èšåˆè®¡ç®—
- æ¯å¹´1æœˆ1æ—¥å‡Œæ™¨è‡ªåŠ¨æ±‡æ€»ä¸Šå¹´æ•°æ®

### 11. åº”ç”¨å…ƒæ•°æ®è¡¨ï¼ˆapp_metadataï¼‰

**ç¼“å­˜åº”ç”¨ä¿¡æ¯**

```sql
CREATE TABLE app_metadata (
    package_name TEXT PRIMARY KEY,
    app_name TEXT NOT NULL,
    category TEXT NOT NULL DEFAULT 'OTHER',
    icon_url TEXT,
    install_time INTEGER,
    is_system BOOLEAN DEFAULT FALSE,
    last_updated INTEGER DEFAULT (strftime('%s', 'now') * 1000)
);

CREATE INDEX idx_app_metadata_category ON app_metadata(category);
```

**å­—æ®µè¯¦ç»†è¯´æ˜ï¼š**

| å­—æ®µå | SQLç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|---------|------|------|
| package_name | TEXT | PRIMARY KEY | åº”ç”¨åŒ…åï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |
| app_name | TEXT | NOT NULL | åº”ç”¨æ˜¾ç¤ºåç§° |
| category | TEXT | DEFAULT 'OTHER' | åº”ç”¨åˆ†ç±»æšä¸¾å€¼ |
| icon_url | TEXT | å¯ä¸ºç©º | åº”ç”¨å›¾æ ‡URLï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰ |
| install_time | INTEGER | å¯ä¸ºç©º | åº”ç”¨å®‰è£…æ—¶é—´æˆ³ |
| is_system | BOOLEAN | DEFAULT FALSE | æ˜¯å¦ä¸ºç³»ç»Ÿåº”ç”¨ |
| last_updated | INTEGER | è‡ªåŠ¨è®¾ç½® | å…ƒæ•°æ®æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•è®¾è®¡ï¼š**
- idx_app_metadata_category: åˆ†ç±»ç´¢å¼•

**ç”¨é€”è¯´æ˜ï¼š**
- ç¼“å­˜åº”ç”¨åŸºæœ¬ä¿¡æ¯ï¼Œå‡å°‘ç³»ç»ŸæŸ¥è¯¢
- æ”¯æŒåº”ç”¨åˆ†ç±»ç»Ÿè®¡
- è¯†åˆ«ç³»ç»Ÿåº”ç”¨å’Œç”¨æˆ·åº”ç”¨

---

## ğŸ” æŸ¥è¯¢ç¤ºä¾‹

### 1. ä»Šæ—¥å››å¤§æ ¸å¿ƒæŒ‡æ ‡æŸ¥è¯¢

**æŸ¥è¯¢1ï¼šä»Šæ—¥APPæ‰“å¼€æ¬¡æ•°**
```sql
-- ç»Ÿè®¡ä»Šæ—¥app_sessionè¡¨çš„è®°å½•æ¡æ•°
SELECT COUNT(*) 
FROM app_session 
WHERE date(start_time/1000, 'unixepoch') = date('now')
```
**è¯´æ˜**ï¼šæ¯æ¡è®°å½•ä»£è¡¨ä¸€æ¬¡APPåˆ‡æ¢åˆ°å‰å°ï¼Œç›´æ¥ç»Ÿè®¡è®°å½•æ•°å³å¯

**æŸ¥è¯¢2ï¼šä»Šæ—¥APPä½¿ç”¨æ—¶é•¿**
```sql
-- æ±‡æ€»ä»Šæ—¥æ‰€æœ‰APPä½¿ç”¨æ—¶é•¿
SELECT COALESCE(SUM(duration), 0) 
FROM app_session 
WHERE date(start_time/1000, 'unixepoch') = date('now')
```
**è¯´æ˜**ï¼šåŒ…å«æ‰€æœ‰è®°å½•ï¼ˆå«duration=0ï¼‰ï¼ŒCOALESCEå¤„ç†æ— æ•°æ®æƒ…å†µ

**æŸ¥è¯¢3ï¼šä»Šæ—¥å±å¹•æ—¶é•¿**
```sql
-- ç»Ÿè®¡SCREEN_ONäº‹ä»¶çš„æ€»æ—¶é•¿
SELECT COALESCE(SUM(duration), 0) 
FROM screen_event 
WHERE event_type = 'SCREEN_ON' 
AND date(timestamp/1000, 'unixepoch') = date('now')
```
**è¯´æ˜**ï¼šéœ€è¦é€šè¿‡SCREEN_ON/OFFäº‹ä»¶é…å¯¹è®¡ç®—ï¼Œdurationå­—æ®µå·²é¢„è®¡ç®—

**æŸ¥è¯¢4ï¼šä»Šæ—¥æ‰‹æœºè§£é”æ¬¡æ•°**

```sql
-- ç»Ÿè®¡USER_PRESENTäº‹ä»¶æ•°é‡
SELECT COUNT(*) 
FROM screen_event 
WHERE event_type = 'USER_PRESENT' 
AND date(timestamp/1000, 'unixepoch') = date('now')
```
**è¯´æ˜**ï¼šæ¯æ¬¡è§£é”è§¦å‘ä¸€æ¬¡USER_PRESENTäº‹ä»¶

### 2. åº”ç”¨åˆ†ç±»ç»Ÿè®¡

**æŸ¥è¯¢1ï¼šä»Šæ—¥å„åˆ†ç±»ä½¿ç”¨ç»Ÿè®¡**
```sql
-- æŒ‰åˆ†ç±»æ±‡æ€»ä¼šè¯æ•°å’Œæ€»æ—¶é•¿
SELECT 
    category, 
    COUNT(*) as session_count,        -- æ‰“å¼€æ¬¡æ•°
    SUM(duration) as total_duration   -- ä½¿ç”¨æ—¶é•¿
FROM app_session 
WHERE date(start_time/1000, 'unixepoch') = date('now')
GROUP BY category
ORDER BY total_duration DESC
```
**ç»“æœç¤ºä¾‹**ï¼š
| category | session_count | total_duration |
|----------|--------------|----------------|
| ç¤¾äº¤ | 45 | 7200000 (2å°æ—¶) |
| å¨±ä¹ | 23 | 5400000 (1.5å°æ—¶) |
| å·¥å…· | 18 | 1800000 (30åˆ†é’Ÿ) |

**æŸ¥è¯¢2ï¼šä»Šæ—¥å„åˆ†ç±»æ‰“å¼€æ¬¡æ•°æ’è¡Œ**
```sql
-- æŒ‰æ‰“å¼€æ¬¡æ•°æ’åº
SELECT 
    category, 
    COUNT(*) as open_count
FROM app_session 
WHERE date(start_time/1000, 'unixepoch') = date('now')
GROUP BY category
ORDER BY open_count DESC
```

### 3. å¤šç»´åº¦æ—¶é—´ç»Ÿè®¡

**æŸ¥è¯¢1ï¼šæœ¬å‘¨ç»Ÿè®¡ï¼ˆåŸºäºå‘¨æ±‡æ€»è¡¨ï¼‰**
```sql
-- æŸ¥è¯¢æœ¬å‘¨æ•°æ®
SELECT * FROM weekly_summary 
WHERE week_key = :weekKey  -- å¦‚ '2024-W42'
```

**æŸ¥è¯¢2ï¼šæœ¬æœˆç»Ÿè®¡ï¼ˆåŸºäºæœˆæ±‡æ€»è¡¨ï¼‰**
```sql
-- æŸ¥è¯¢æœ¬æœˆæ•°æ®
SELECT * FROM monthly_summary 
WHERE month_key = :monthKey  -- å¦‚ '2024-10'
```

**æŸ¥è¯¢3ï¼šæœ¬å¹´ç»Ÿè®¡ï¼ˆåŸºäºå¹´æ±‡æ€»è¡¨ï¼‰**
```sql
-- æŸ¥è¯¢æœ¬å¹´æ•°æ®
SELECT * FROM yearly_summary 
WHERE year = :year  -- å¦‚ 2024
```

**æŸ¥è¯¢4ï¼šè‡ªå®šä¹‰æ—¶é—´èŒƒå›´ç»Ÿè®¡ï¼ˆèšåˆæ—¥æ±‡æ€»è¡¨ï¼‰**
```sql
-- æŸ¥è¯¢æŒ‡å®šæ—¶é—´èŒƒå›´çš„æ±‡æ€»æ•°æ®
SELECT 
    SUM(total_screen_time) as total_screen_time,
    SUM(phone_unlock_count) as phone_unlock_count,
    SUM(app_open_count) as app_open_count,
    SUM(app_usage_duration) as app_usage_duration
FROM daily_summary 
WHERE date BETWEEN :startDate AND :endDate
```

**å¤šç»´åº¦æŸ¥è¯¢æµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚] --> B{æ£€æŸ¥æ—¶é—´ç»´åº¦}
    B -->|DAILY| C{æ˜¯å¦ä»Šæ—¥?}
    C -->|æ˜¯| D[æŸ¥è¯¢app_session/screen_eventåŸå§‹è¡¨]
    C -->|å¦| E[æŸ¥è¯¢daily_summary]
    B -->|WEEKLY| F{æ˜¯å¦å·²æœ‰å‘¨æ±‡æ€»?}
    F -->|æ˜¯| G[æŸ¥è¯¢weekly_summary]
    F -->|å¦| H[èšåˆdaily_summary]
    B -->|MONTHLY| I{æ˜¯å¦å·²æœ‰æœˆæ±‡æ€»?}
    I -->|æ˜¯| J[æŸ¥è¯¢monthly_summary]
    I -->|å¦| K[èšåˆdaily_summary]
    B -->|YEARLY| L{æ˜¯å¦å·²æœ‰å¹´æ±‡æ€»?}
    L -->|æ˜¯| M[æŸ¥è¯¢yearly_summary]
    L -->|å¦| N[èšåˆdaily_summary]
    B -->|CUSTOM| O[èšåˆdaily_summaryæŒ‡å®šèŒƒå›´]
```

### 4. å•åº”ç”¨ç»´åº¦ç»Ÿè®¡

**æŸ¥è¯¢1ï¼šæŸ¥è¯¢æŒ‡å®šåº”ç”¨çš„å†å²æ•°æ®ï¼ˆæ—¥ç»´åº¦ï¼‰**
```sql
-- æŸ¥è¯¢å¾®ä¿¡æœ€è¿‘7å¤©çš„ä½¿ç”¨æƒ…å†µ
SELECT 
    date,
    app_open_count,
    app_usage_duration
FROM daily_app_summary 
WHERE package_name = 'com.tencent.mm'
AND date >= date('now', '-7 days')
ORDER BY date DESC
```

**æŸ¥è¯¢2ï¼šæŸ¥è¯¢æŒ‡å®šåº”ç”¨çš„å‘¨ç»Ÿè®¡**
```sql
-- åŸºäºdaily_app_summaryèšåˆæœ¬å‘¨æ•°æ®
SELECT 
    SUM(app_open_count) as weekly_open_count,
    SUM(app_usage_duration) as weekly_usage_duration
FROM daily_app_summary 
WHERE package_name = :packageName
AND date BETWEEN :weekStartDate AND :weekEndDate
```

**æŸ¥è¯¢3ï¼šåº”ç”¨æ’è¡Œæ¦œï¼ˆæŒ‰ä½¿ç”¨æ—¶é•¿ï¼‰**
```sql
-- æŸ¥è¯¢ä»Šæ—¥åº”ç”¨ä½¿ç”¨æ—¶é•¿TOP 10
SELECT 
    package_name,
    app_name,
    category,
    app_usage_duration
FROM daily_app_summary 
WHERE date = date('now')
ORDER BY app_usage_duration DESC
LIMIT 10
```

**å•åº”ç”¨æŸ¥è¯¢æµç¨‹å›¾**ï¼š

```mermaid
flowchart TD
    A[å•åº”ç”¨æŸ¥è¯¢è¯·æ±‚] --> B{æ£€æŸ¥æ—¶é—´ç»´åº¦}
    B -->|DAILY| C{æ˜¯å¦ä»Šæ—¥?}
    C -->|æ˜¯| D[å®æ—¶èšåˆapp_session]
    C -->|å¦| E[æŸ¥è¯¢daily_app_summary]
    B -->|WEEKLY/MONTHLY/YEARLY| F[èšåˆdaily_app_summary]
    B -->|CUSTOM| G[èšåˆdaily_app_summaryæŒ‡å®šèŒƒå›´]
    D --> H[è¿”å›ç»“æœ]
    E --> H
    F --> H
    G --> H
```

### 5. åˆ†ç±»ç»´åº¦ç»Ÿè®¡

**æŸ¥è¯¢1ï¼šæŸ¥è¯¢æŒ‡å®šåˆ†ç±»çš„ä»Šæ—¥æ•°æ®**
```sql
-- æŸ¥è¯¢ç¤¾äº¤ç±»åº”ç”¨çš„ä»Šæ—¥ç»Ÿè®¡
SELECT 
    SUM(app_open_count) as category_open_count,
    SUM(app_usage_duration) as category_usage_duration
FROM daily_app_summary 
WHERE category = 'SOCIAL'
AND date = date('now')
```

**æŸ¥è¯¢2ï¼šæŸ¥è¯¢åˆ†ç±»çš„å†å²è¶‹åŠ¿**
```sql
-- æŸ¥è¯¢ç¤¾äº¤ç±»åº”ç”¨æœ€è¿‘7å¤©çš„ä½¿ç”¨è¶‹åŠ¿
SELECT 
    date,
    SUM(app_open_count) as daily_open_count,
    SUM(app_usage_duration) as daily_usage_duration
FROM daily_app_summary 
WHERE category = :category
AND date >= date('now', '-7 days')
GROUP BY date
ORDER BY date
```

### 6. æœ€æ´»è·ƒåº”ç”¨ç»Ÿè®¡

**æŸ¥è¯¢1ï¼šä»Šæ—¥æœ€æ´»è·ƒåº”ç”¨ï¼ˆæŒ‰æ—¶é•¿æ’åºï¼‰**
```sql
-- ç»Ÿè®¡æ¯ä¸ªAPPçš„ä½¿ç”¨æƒ…å†µï¼ŒæŒ‰æ€»æ—¶é•¿æ’åº
SELECT 
    package_name, 
    app_name, 
    category, 
    COUNT(*) as session_count,           -- æ‰“å¼€æ¬¡æ•°
    SUM(duration) as total_duration,     -- æ€»ä½¿ç”¨æ—¶é•¿
    AVG(duration) as avg_duration        -- å¹³å‡å•æ¬¡æ—¶é•¿
FROM app_session 
WHERE date(start_time/1000, 'unixepoch') = date('now')
GROUP BY package_name
ORDER BY total_duration DESC
LIMIT 10
```
**ç»“æœç¤ºä¾‹**ï¼š
| app_name | session_count | total_duration | avg_duration |
|----------|--------------|----------------|--------------|
| å¾®ä¿¡ | 23 | 7200000 (2å°æ—¶) | 313043 (5.2åˆ†é’Ÿ) |
| æŠ–éŸ³ | 15 | 5400000 (1.5å°æ—¶) | 360000 (6åˆ†é’Ÿ) |

**æŸ¥è¯¢2ï¼šä»Šæ—¥æœ€é¢‘ç¹æ‰“å¼€åº”ç”¨ï¼ˆæŒ‰æ¬¡æ•°æ’åºï¼‰**
```sql
-- æŒ‰æ‰“å¼€æ¬¡æ•°æ’åºï¼ˆä¸è€ƒè™‘æ—¶é•¿ï¼‰
SELECT 
    package_name, 
    app_name, 
    category, 
    COUNT(*) as open_count
FROM app_session 
WHERE date(start_time/1000, 'unixepoch') = date('now')
GROUP BY package_name
ORDER BY open_count DESC
LIMIT 10
```
**åº”ç”¨åœºæ™¯**ï¼š
- æŸ¥è¯¢1ï¼šæŸ¥çœ‹å“ªäº›APPå ç”¨æ—¶é—´æœ€å¤š
- æŸ¥è¯¢2ï¼šæŸ¥çœ‹å“ªäº›APPåˆ‡æ¢æœ€é¢‘ç¹

---

## âš ï¸ æ•°æ®ä¸€è‡´æ€§è§„åˆ™

### 1. æœ€å°æ—¶é•¿é˜ˆå€¼å¤„ç†

**åŸåˆ™ï¼šè¡Œä¸ºå¿…é¡»è®°å½•ï¼Œæ—¶é•¿å¯ä»¥è¿‡æ»¤**

**å¤„ç†é€»è¾‘**ï¼š
```mermaid
flowchart TD
    A[ä¼šè¯ç»“æŸ] --> B[è®¡ç®—å®é™…æ—¶é•¿<br/>actualDuration = endTime - startTime]
    B --> C{actualDuration < 1000ms?}
    C -->|æ˜¯| D[è®¾ç½® duration = 0]
    C -->|å¦| E[è®¾ç½® duration = actualDuration]
    D --> F[ä¿å­˜ä¼šè¯è®°å½•]
    E --> F
    F --> G[è®°å½•å‚ä¸æ‰“å¼€æ¬¡æ•°ç»Ÿè®¡]
```

**æ ¸å¿ƒè¦ç‚¹**ï¼š
1. **å¿…é¡»ä¿å­˜è®°å½•**ï¼šæ— è®ºä½¿ç”¨æ—¶é•¿å¤šçŸ­ï¼Œéƒ½è¦ä¿å­˜åˆ°æ•°æ®åº“
2. **æ—¶é•¿å¯ä»¥ä¸º0**ï¼š< 1ç§’çš„ä¼šè¯ï¼Œdurationå­—æ®µè®¾ä¸º0
3. **ç»Ÿè®¡ä»ç„¶å‡†ç¡®**ï¼š
   - APPæ‰“å¼€æ¬¡æ•° = COUNT(*) âœ… ï¼ˆåŒ…å«æ‰€æœ‰è®°å½•ï¼‰
   - APPä½¿ç”¨æ—¶é•¿ = SUM(duration) âœ… ï¼ˆè‡ªåŠ¨è¿‡æ»¤0æ—¶é•¿ï¼‰

### 2. ç»Ÿè®¡æŸ¥è¯¢ä¸€è‡´æ€§

**ç»Ÿè®¡æ–¹å¼å¯¹æ¯”**ï¼š

| ç»Ÿè®¡æŒ‡æ ‡ | SQLæŸ¥è¯¢ | æ˜¯å¦åŒ…å«duration=0è®°å½• | è¯´æ˜ |
|---------|---------|---------------------|------|
| APPæ‰“å¼€æ¬¡æ•° | `COUNT(*)` | âœ… åŒ…å« | æ‰€æœ‰è®°å½•éƒ½è®¡æ•° |
| APPä½¿ç”¨æ—¶é•¿ | `SUM(duration)` | âœ… è‡ªåŠ¨å¿½ç•¥ | SUMè‡ªåŠ¨è·³è¿‡0å€¼ |

**æŸ¥è¯¢ç¤ºä¾‹**ï¼š

**æ–¹å¼1ï¼šåŒ…å«æ‰€æœ‰è®°å½•ï¼ˆæ¨èï¼‰**
```sql
-- APPæ‰“å¼€æ¬¡æ•°
SELECT COUNT(*) FROM app_session WHERE date = :date

-- APPä½¿ç”¨æ—¶é•¿ï¼ˆè‡ªåŠ¨è¿‡æ»¤0æ—¶é•¿ï¼‰
SELECT SUM(duration) FROM app_session WHERE date = :date
```

**æ–¹å¼2ï¼šæ˜¾å¼è¿‡æ»¤çŸ­æ—¶ä¼šè¯ï¼ˆå¯é€‰ï¼‰**
```sql
-- åªç»Ÿè®¡æœ‰æ•ˆä¼šè¯
SELECT SUM(duration) FROM app_session 
WHERE date = :date AND duration >= 1000
```

**æ¨èä½¿ç”¨æ–¹å¼1**ï¼Œå› ä¸ºï¼š
- æ‰“å¼€æ¬¡æ•°ç»Ÿè®¡æ›´å‡†ç¡®
- SUMä¼šè‡ªåŠ¨è·³è¿‡duration=0çš„è®°å½•
- æŸ¥è¯¢é€»è¾‘æ›´ç®€å•

---

## ğŸ”§ æ•°æ®åº“å‡çº§ç­–ç•¥

### ä»v1.0åˆ°v2.1çš„è¿ç§»

**æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†**ï¼š

| ç‰ˆæœ¬å· | åŒ…å«å®ä½“ | æ›´æ–°å†…å®¹ |
|--------|---------|---------|
| v1 | usage_tracking | æ—§ç‰ˆæœ¬ï¼ˆå¾…åºŸå¼ƒï¼‰ |
| v2 | åŸºç¡€è¡¨ | åˆå§‹åŒ–æ–°è¡¨ç»“æ„ |
| v3 | 7å¼ æ ¸å¿ƒè¡¨ | å®Œæ•´v2.1æ¶æ„ |

**æ ¸å¿ƒå®ä½“æ¸…å•**ï¼š

| åºå· | å®ä½“å | è¡¨å | æ•°æ®ç±»å‹ | ç”¨é€” |
|-----|--------|------|---------|------|
| 1 | AppSession | app_session | åŸå§‹æ•°æ® | è®°å½•æ¯æ¬¡åº”ç”¨ä½¿ç”¨ä¼šè¯ |
| 2 | AppUsageDetail | app_usage_detail | åŸå§‹æ•°æ® | è®°å½•ä¼šè¯å†…çŠ¶æ€å˜åŒ–æ˜ç»† |
| 3 | ScreenEvent | screen_event | åŸå§‹æ•°æ® | è®°å½•å±å¹•å¼€å…³å’Œè§£é”äº‹ä»¶ |
| 4 | NotificationEvent | notification_event | åŸå§‹æ•°æ® | è®°å½•é€šçŸ¥äº‹ä»¶ |
| 5 | DailySummary | daily_summary | æ—¥æ±‡æ€» | å…¨å±€æ¯æ—¥å››å¤§æŒ‡æ ‡æ±‡æ€» |
| 6 | DailyAppSummary | daily_app_summary | æ—¥æ±‡æ€» | æ¯æ—¥å•åº”ç”¨ç»Ÿè®¡æ•°æ® |
| 7 | WeeklySummary | weekly_summary | å‘¨æ±‡æ€» | å…¨å±€æ¯å‘¨å››å¤§æŒ‡æ ‡æ±‡æ€» |
| 8 | MonthlySummary | monthly_summary | æœˆæ±‡æ€» | å…¨å±€æ¯æœˆå››å¤§æŒ‡æ ‡æ±‡æ€» |
| 9 | YearlySummary | yearly_summary | å¹´æ±‡æ€» | å…¨å±€æ¯å¹´å››å¤§æŒ‡æ ‡æ±‡æ€» |
| 10 | UserGoal | user_goal | é…ç½®æ•°æ® | ç”¨æˆ·è®¾å®šçš„ä½¿ç”¨ç›®æ ‡ |
| 11 | AppMetadata | app_metadata | å…ƒæ•°æ® | åº”ç”¨åŸºæœ¬ä¿¡æ¯ç¼“å­˜ |

**æ•°æ®åˆ†å±‚æ¶æ„**ï¼š

```mermaid
graph TB
    subgraph åŸå§‹æ•°æ®å±‚
        A1[app_session]
        A2[screen_event]
        A3[app_usage_detail]
        A4[notification_event]
    end
    
    subgraph æ—¥æ±‡æ€»å±‚
        B1[daily_summary<br/>å…¨å±€æ—¥æ±‡æ€»]
        B2[daily_app_summary<br/>å•åº”ç”¨æ—¥æ±‡æ€»]
    end
    
    subgraph å‘¨æœŸæ±‡æ€»å±‚
        C1[weekly_summary<br/>å‘¨æ±‡æ€»]
        C2[monthly_summary<br/>æœˆæ±‡æ€»]
        C3[yearly_summary<br/>å¹´æ±‡æ€»]
    end
    
    subgraph å…ƒæ•°æ®å±‚
        D1[app_metadata]
        D2[user_goal]
    end
    
    A1 --> B1
    A1 --> B2
    A2 --> B1
    D1 --> B2
    
    B1 --> C1
    B1 --> C2
    B1 --> C3
    
    style B1 fill:#e1f5fe
    style B2 fill:#e1f5fe
    style C1 fill:#fff9c4
    style C2 fill:#fff9c4
    style C3 fill:#fff9c4
```

**è¿ç§»æµç¨‹ï¼ˆv2 â†’ v3ï¼‰**ï¼š

```mermaid
flowchart TD
    A[å¼€å§‹è¿ç§»] --> B[1. é‡å‘½åæ—§è¡¨<br/>app_sessions â†’ app_session_old]
    B --> C[2. åˆ›å»ºæ–°è¡¨<br/>app_session with new schema]
    C --> D[3. æ•°æ®è¿ç§»<br/>å¤„ç†å­—æ®µå˜åŒ–]
    D --> E[4. åˆ é™¤æ—§è¡¨]
    E --> F[5. åˆ›å»ºç´¢å¼•]
    F --> G[å®Œæˆè¿ç§»]
```

**å­—æ®µè¿ç§»æ˜ å°„**ï¼š
- session_id: ä¿æŒä¸å˜ï¼ˆè‹¥ä¸ºç©ºåˆ™ç”ŸæˆUUIDï¼‰
- open_count â†’ switch_count (è¯­ä¹‰å˜æ›´)
- æ–°å¢å­—æ®µä½¿ç”¨é»˜è®¤å€¼

---

## ğŸ“… æ•°æ®æ±‡æ€»ç­–ç•¥

### æ±‡æ€»ä»»åŠ¡è°ƒåº¦

**å®šæ—¶æ±‡æ€»ä»»åŠ¡æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[ç³»ç»Ÿåå°ä»»åŠ¡è°ƒåº¦å™¨] --> B[æ¯æ—¥å‡Œæ™¨00:10]
    B --> C[æ‰§è¡Œæ—¥æ±‡æ€»ä»»åŠ¡]
    C --> D[æ±‡æ€»å‰ä¸€æ—¥app_sessionæ•°æ®]
    C --> E[æ±‡æ€»å‰ä¸€æ—¥screen_eventæ•°æ®]
    D --> F[æ›´æ–°daily_app_summary]
    D --> G[æ›´æ–°daily_summary]
    E --> G
    
    A --> H[æ¯å‘¨ä¸€å‡Œæ™¨01:00]
    H --> I[æ‰§è¡Œå‘¨æ±‡æ€»ä»»åŠ¡]
    I --> J[èšåˆä¸Šå‘¨daily_summary]
    J --> K[æ›´æ–°weekly_summary]
    
    A --> L[æ¯æœˆ1æ—¥å‡Œæ™¨02:00]
    L --> M[æ‰§è¡Œæœˆæ±‡æ€»ä»»åŠ¡]
    M --> N[èšåˆä¸Šæœˆdaily_summary]
    N --> O[æ›´æ–°monthly_summary]
    
    A --> P[æ¯å¹´1æœˆ1æ—¥å‡Œæ™¨03:00]
    P --> Q[æ‰§è¡Œå¹´æ±‡æ€»ä»»åŠ¡]
    Q --> R[èšåˆå»å¹´daily_summary]
    R --> S[æ›´æ–°yearly_summary]
```

### æ±‡æ€»ä»»åŠ¡è¯¦ç»†è¯´æ˜

| ä»»åŠ¡åç§° | æ‰§è¡Œæ—¶é—´ | æ•°æ®æº | ç›®æ ‡è¡¨ | è®¡ç®—èŒƒå›´ | å¤‡æ³¨ |
|---------|---------|-------|--------|---------|------|
| æ—¥æ±‡æ€»ä»»åŠ¡ | æ¯æ—¥00:10 | app_session, screen_event | daily_summary, daily_app_summary | å‰ä¸€æ—¥00:00-23:59 | å…¨å±€+å•åº”ç”¨ |
| å‘¨æ±‡æ€»ä»»åŠ¡ | å‘¨ä¸€01:00 | daily_summary | weekly_summary | ä¸Šå‘¨ä¸€è‡³ä¸Šå‘¨æ—¥ | ä»…å…¨å±€æ±‡æ€» |
| æœˆæ±‡æ€»ä»»åŠ¡ | æ¯æœˆ1æ—¥02:00 | daily_summary | monthly_summary | ä¸Šæœˆ1æ—¥è‡³ä¸Šæœˆæœ« | ä»…å…¨å±€æ±‡æ€» |
| å¹´æ±‡æ€»ä»»åŠ¡ | 1æœˆ1æ—¥03:00 | daily_summary | yearly_summary | å»å¹´1æœˆ1æ—¥è‡³12æœˆ31æ—¥ | ä»…å…¨å±€æ±‡æ€» |

### æ—¥æ±‡æ€»ä»»åŠ¡SQLç¤ºä¾‹

**1. æ›´æ–°daily_summaryï¼ˆå…¨å±€æ—¥æ±‡æ€»ï¼‰**ï¼š
```sql
INSERT OR REPLACE INTO daily_summary (
    summary_id,
    date,
    total_screen_time,
    phone_unlock_count,
    app_open_count,
    app_usage_duration
)
SELECT 
    -- ä½¿ç”¨UUIDç”Ÿæˆsummary_id
    lower(hex(randomblob(16))),
    :targetDate,
    -- è®¡ç®—å±å¹•æ—¶é•¿
    COALESCE((SELECT SUM(duration) FROM screen_event 
              WHERE event_type = 'SCREEN_ON' 
              AND date(timestamp/1000, 'unixepoch') = :targetDate), 0),
    -- è®¡ç®—è§£é”æ¬¡æ•°
    COALESCE((SELECT COUNT(*) FROM screen_event 
              WHERE event_type = 'USER_PRESENT' 
              AND date(timestamp/1000, 'unixepoch') = :targetDate), 0),
    -- è®¡ç®—APPæ‰“å¼€æ¬¡æ•°
    COALESCE((SELECT COUNT(*) FROM app_session 
              WHERE date(start_time/1000, 'unixepoch') = :targetDate), 0),
    -- è®¡ç®—APPä½¿ç”¨æ—¶é•¿
    COALESCE((SELECT SUM(duration) FROM app_session 
              WHERE date(start_time/1000, 'unixepoch') = :targetDate), 0)
```

**2. æ›´æ–°daily_app_summaryï¼ˆå•åº”ç”¨æ—¥æ±‡æ€»ï¼‰**ï¼š
```sql
INSERT OR REPLACE INTO daily_app_summary (
    summary_id,
    date,
    package_name,
    app_name,
    category,
    app_open_count,
    app_usage_duration
)
SELECT 
    lower(hex(randomblob(16))),
    :targetDate,
    package_name,
    app_name,
    category,
    COUNT(*) as app_open_count,
    COALESCE(SUM(duration), 0) as app_usage_duration
FROM app_session
WHERE date(start_time/1000, 'unixepoch') = :targetDate
GROUP BY package_name, app_name, category
```

### å‘¨æ±‡æ€»ä»»åŠ¡SQLç¤ºä¾‹

```sql
INSERT OR REPLACE INTO weekly_summary (
    summary_id,
    week_key,
    year,
    week_of_year,
    start_date,
    end_date,
    total_screen_time,
    phone_unlock_count,
    app_open_count,
    app_usage_duration
)
SELECT 
    lower(hex(randomblob(16))),
    :weekKey,  -- å¦‚ '2024-W42'
    :year,
    :weekOfYear,
    :startDate,  -- å‘¨ä¸€æ—¥æœŸ
    :endDate,    -- å‘¨æ—¥æ—¥æœŸ
    SUM(total_screen_time),
    SUM(phone_unlock_count),
    SUM(app_open_count),
    SUM(app_usage_duration)
FROM daily_summary
WHERE date BETWEEN :startDate AND :endDate
```

### å®æ—¶æŸ¥è¯¢ vs é¢„è®¡ç®—æŸ¥è¯¢

**æŸ¥è¯¢ç­–ç•¥å†³ç­–æµç¨‹**ï¼š

```mermaid
flowchart TD
    A[æ”¶åˆ°ç»Ÿè®¡æŸ¥è¯¢è¯·æ±‚] --> B{æŸ¥è¯¢æ—¶é—´èŒƒå›´}
    B -->|ä»Šæ—¥| C[å®æ—¶æŸ¥è¯¢åŸå§‹è¡¨]
    B -->|å†å²å•æ—¥| D[æŸ¥è¯¢daily_summary]
    B -->|æœ¬å‘¨æœªå®Œæ•´| E[å®æ—¶èšåˆdaily_summary]
    B -->|å†å²å®Œæ•´å‘¨| F{æ˜¯å¦æœ‰å‘¨æ±‡æ€»?}
    F -->|æœ‰| G[æŸ¥è¯¢weekly_summary]
    F -->|æ— | H[å®æ—¶èšåˆdaily_summary]
    B -->|æœ¬æœˆæœªå®Œæ•´| I[å®æ—¶èšåˆdaily_summary]
    B -->|å†å²å®Œæ•´æœˆ| J{æ˜¯å¦æœ‰æœˆæ±‡æ€»?}
    J -->|æœ‰| K[æŸ¥è¯¢monthly_summary]
    J -->|æ— | L[å®æ—¶èšåˆdaily_summary]
    B -->|å†å²å®Œæ•´å¹´| M{æ˜¯å¦æœ‰å¹´æ±‡æ€»?}
    M -->|æœ‰| N[æŸ¥è¯¢yearly_summary]
    M -->|æ— | O[å®æ—¶èšåˆdaily_summary]
    B -->|è‡ªå®šä¹‰èŒƒå›´| P[èšåˆdaily_summary]
    
    C --> Q[è¿”å›ç»“æœ]
    D --> Q
    E --> Q
    G --> Q
    H --> Q
    I --> Q
    K --> Q
    L --> Q
    N --> Q
    O --> Q
    P --> Q
```

### æ•°æ®ä¸€è‡´æ€§ä¿éšœ

**æ±‡æ€»ä»»åŠ¡å¹‚ç­‰æ€§**ï¼š
- ä½¿ç”¨ `INSERT OR REPLACE` ä¿è¯é‡å¤æ‰§è¡Œä¸ä¼šäº§ç”Ÿé‡å¤æ•°æ®
- ä½¿ç”¨UNIQUEçº¦æŸï¼ˆå¦‚dateå­—æ®µã€week_keyå­—æ®µï¼‰é˜²æ­¢é‡å¤
- æ±‡æ€»ä»»åŠ¡å¤±è´¥å¯é‡æ–°æ‰§è¡Œï¼Œä¸å½±å“æ•°æ®å‡†ç¡®æ€§

**æ±‡æ€»ä»»åŠ¡ç›‘æ§**ï¼š
- è®°å½•æ¯æ¬¡æ±‡æ€»ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€
- å¤±è´¥æ—¶è§¦å‘å‘Šè­¦å¹¶é‡è¯•
- å®šæœŸæ£€æŸ¥æ±‡æ€»è¡¨çš„å®Œæ•´æ€§

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

* [æœ¯è¯­ç»Ÿä¸€è¡¨ v2.1](./æœ¯è¯­ç»Ÿä¸€è¡¨.md) - æœ¯è¯­æƒå¨æ ‡å‡†

* [æ ¸å¿ƒæŒ‡æ ‡å®šä¹‰è¯´æ˜](./æ ¸å¿ƒæŒ‡æ ‡å®šä¹‰è¯´æ˜.md) - ç»Ÿè®¡é€»è¾‘è¯¦ç»†è¯´æ˜

* [æŠ€æœ¯è¯´æ˜_ç»Ÿè®¡ç³»ç»Ÿæ¶æ„](./æŠ€æœ¯è¯´æ˜_ç»Ÿè®¡ç³»ç»Ÿæ¶æ„.md) - ç³»ç»Ÿæ¶æ„è¯´æ˜

* [å‰ç«¯UIè®¾è®¡æ–¹æ¡ˆ v2](./å‰ç«¯UIè®¾è®¡æ–¹æ¡ˆ_v2.md) - UIè®¾è®¡è§„èŒƒ

* [å®ç°è·¯çº¿å›¾ v2](./å®ç°è·¯çº¿å›¾_v2.md) - å¼€å‘è®¡åˆ’

---

## ğŸ“ ç‰ˆæœ¬å†å²

* **v2.2 (2025-10-15)**ï¼š

  * âœ… æ–°å¢å¤šç»´åº¦æ—¶é—´æŸ¥è¯¢æ”¯æŒï¼ˆæ—¥/å‘¨/æœˆ/å¹´/è‡ªå®šä¹‰ï¼‰

  * âœ… æ–°å¢4å¼ æ±‡æ€»è¡¨ï¼šdaily\_app\_summary, weekly\_summary, monthly\_summary, yearly\_summary

  * âœ… æ–°å¢StatsQueryæŸ¥è¯¢å‚æ•°æ¨¡å‹

  * âœ… æ–°å¢TimeRangeæ—¶é—´èŒƒå›´æ¨¡å‹

  * âœ… æ–°å¢å¤šç»´åº¦æŸ¥è¯¢ç¤ºä¾‹å’Œæµç¨‹å›¾

  * âœ… æ–°å¢æ•°æ®æ±‡æ€»ç­–ç•¥å’Œä»»åŠ¡è°ƒåº¦è¯´æ˜

  * âœ… æ–°å¢æ•°æ®åˆ†å±‚æ¶æ„å›¾ï¼ˆåŸå§‹æ•°æ®â†’æ—¥æ±‡æ€»â†’å‘¨æœŸæ±‡æ€»ï¼‰

  * âœ… å®Œå–„æŸ¥è¯¢ç¤ºä¾‹ï¼šå¢åŠ å•åº”ç”¨ã€åˆ†ç±»ã€å¤šç»´åº¦ç»Ÿè®¡

  * âœ… ä¸æœ¯è¯­ç»Ÿä¸€è¡¨v2.3å®Œå…¨åŒæ­¥

* **v2.1 (2025-10-15)**ï¼š

  * âœ… ç»Ÿä¸€è¡¨åä¸ºå•æ•°å½¢å¼ï¼ˆapp\_sessionç­‰ï¼‰

  * âœ… åˆ é™¤openCountå­—æ®µï¼Œæ”¹ç”¨COUNT(\*)ç»Ÿè®¡

  * âœ… æ–°å¢switch\_countå­—æ®µè¡¨ç¤ºä¼šè¯å†…åˆ‡æ¢æ¬¡æ•°

  * âœ… æ˜ç¡®æœ€å°æ—¶é•¿é˜ˆå€¼å¤„ç†é€»è¾‘ï¼ˆ<1ç§’è®¾ä¸º0ï¼‰

  * âœ… ä¸æœ¯è¯­ç»Ÿä¸€è¡¨v2.1å®Œå…¨åŒæ­¥

* **v2.0 (2025-10-14)**ï¼š

  * åˆå§‹ç‰ˆæœ¬ï¼Œå¼•å…¥å››å¤§æ ¸å¿ƒæŒ‡æ ‡

  * è®¾è®¡AppSessionç­‰æ–°æ•°æ®ç»“æ„

* **v1.0 (æ—§ç‰ˆ)**ï¼š

  * ä½¿ç”¨å¤æ•°è¡¨åå’ŒopenCountå­—æ®µ

  * æœ¯è¯­å®šä¹‰ä¸ç»Ÿä¸€

